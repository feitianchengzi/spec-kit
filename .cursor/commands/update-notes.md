---
description: 生成简洁易读的更新说明文档
---

根据提供的客户需求参数，执行以下操作：

1. **获取版本信息**：fetch origin/main，以 pyproject.toml 为准获取当前版本号、当前CommitID 和更新版本号、更新CommitID

2. **检查更新**：如果版本号无变化则停止

3. **生成唯一性标识**：定义 **更新内容唯一性标识**，格式为 `v[当前版本号]+[当前CommitID]-v[更新版本号]+

4. **生成差异文件**：使用 `git diff HEAD origin/main` 生成 `update-notes/[更新内容唯一性标识]-git-diff.txt`

5. **分析文件变更** 分析 `update-notes/[更新内容唯一性标识]-git-diff.txt` 的内容：
   - 先找出所有增删改的文件，因文件较大，使用脚本辅助分析
   - 排除分支文件，忽略 learn-spec-kit、sync-and-translate、update-notes、.cursor/commands、test-env 等分支特有目录
   - 分析文件的作用，生成文件变更分析报告，为文档生成做准备
   - **关键验证**：对于AI代理支持，必须提取并对比两个版本的实际代理列表，区分新增、变更、删除

6. **分析核心变更**：从文件变更分析报告中，识别所有改进：

   **用户可感知的改进**（需要详细说明）：
   - **CLI工具**：安装体验、项目初始化、工具检查、用户交互等用户直接使用的功能
   - **AI代理支持**：新增代理、代理优化、代理功能增强等用户能感知到的代理改进
   - **命令系统**：新增命令、命令优化、命令功能增强等用户直接使用的命令改进

   **底层技术支撑**（需要简要说明）：
   - **脚本与自动化**：分析脚本功能增强、自动化流程改进、跨平台支持优化、错误处理机制等具体技术改进点
   - **发布与交付**：分析CI/CD流程重构、版本管理机制、包构建自动化、发布脚本模块化等具体技术改进点
   - **配置与环境**：分析代理配置结构、目录布局标准化、文件格式适配、开发环境配置等具体技术改进点
   - **文档与指南**：分析文档结构完善、用户指南优化、示例代码更新、集成配置改进等具体技术改进点

   **系统性分析要求**：
   - **AI代理分析**：必须提取当前版本和更新版本的完整代理列表进行对比
     - 使用 `git show [当前CommitID]:src/specify_cli/__init__.py` 和 `git show [更新CommitID]:src/specify_cli/__init__.py` 提取代理列表
     - 对比两个列表，明确标识新增、变更、删除的代理
     - **版本历史验证**：通过CHANGELOG.md验证代理的添加时间，避免将历史新增误认为当前版本新增
     - **深度分析**：不仅看代理数量，还要分析配置结构变化对用户体验的影响
   - **命令系统分析**：必须对比所有命令文件的变化
     - 使用 `ls templates/commands/` 对比两个版本的命令文件列表
     - 分析现有命令的优化改进，不仅仅是新增命令
     - **功能层面分析**：深入分析每个现有命令文件的具体变更内容
     - **结构优化分析**：分析命令结构、用户输入格式、工作流程的改进
     - **功能增强分析**：识别现有命令新增的功能特性
     - **体验分析**：分析命令结构、提示优化对用户使用体验的改进
   - **功能变更分析**：区分新增、优化、重构、删除，避免将重构误认为新增
   - **用户价值分析**：每个改进都要从用户使用角度分析实际价值和影响
   - **交叉验证**：通过多个文件（如CHANGELOG.md、README.md）验证分析结果

7. **生成更新说明**：基于分析结果，参考模板文件 `update-notes/update-notes-template.md` ，生成简洁的更新说明文档，保存到 `update-notes/[更新内容唯一性标识]-update-notes.md` 文件中：
   - **更新说明内容**：
     - **更新概览**：完整阐述用户可感知的改进点，每个点一句话说明价值和影响
     - **详细使用改进**：CLI工具、AI代理支持、命令系统，每个改进都要详细展开说明
   - **通用原则**：
     - 使用简体中文，从用户角度描述改进内容
     - 用词要准确，注意区分新增、优化、重构的差异
     - 功能点罗列不要用"等"，应该完整罗列
     - 突出对用户的实际价值和影响，让用户在30秒内理解本次更新的核心价值
   - **内容详细要求**：
     - **结构化展示**：按功能模块分类，每个功能都有明确的标题和子功能
     - **使用场景明确**：每个功能都说明在什么情况下用户会用到
     - **具体改进详细**：详细说明每个功能的具体改进内容，包含技术细节但以用户价值为导向
     - **用户价值突出**：每个功能都明确说明用户能获得什么好处，避免纯技术描述
     - **去掉技术细节**：不描述实现方式、技术细节、配置变更等用户不关心的内容
     - **聚焦用户价值**：只说明用户能直接感知到的改进和好处
   - **内容优化要求**：
     - **AI代理支持**：新增代理和优化现有代理要分开说明，说明代理的用途和用户价值
     - **命令系统**：新增命令和优化现有命令要分开说明，说明命令的功能和用户价值
     - **CLI工具**：突出用户体验改进，说明用户能感受到的功能增强
     - **用户语言**：使用用户容易理解的语言，避免技术术语
     - **价值导向**：每个描述都要明确说明对用户的实际价值和好处
     - **详细展开**：每个功能都要详细展开，包括使用场景、具体改进、用户价值三个维度

8.  **验证准确性**：与代码差异比对，确保事实准确，无遗漏重要变更
   - **AI代理验证**：对比两个版本的代理列表，确认新增/变更/删除的准确性，通过CHANGELOG.md验证代理添加时间
   - **命令系统验证**：对比两个版本的命令文件列表，确认新增/优化/删除的准确性
   - **功能验证**：通过CHANGELOG.md验证功能变更的准确性，避免将历史功能误认为当前版本新增
   - **版本历史验证**：检查CHANGELOG.md中的版本历史，确保功能变更时间线的准确性
   - **用户价值验证**：确保每个改进都从用户使用角度进行了价值分析
   - **完整性检查**：确保所有用户可感知的改进都被正确识别和描述
   - **语言检查**：确保描述使用用户语言，避免技术术语，突出用户价值
   - **底层技术支撑检查**：确认已精炼汇总"脚本与自动化 / 发布与交付 / 配置与环境 / 文档与指南"的变更要点

9. **分析检查清单**：确保分析过程完整无遗漏
   - **AI代理检查**：
     - [ ] 提取了当前版本和更新版本的完整代理列表
     - [ ] 对比分析了新增、变更、删除的代理
     - [ ] 通过CHANGELOG.md验证了代理的添加时间，避免历史新增误认为当前新增
     - [ ] 分析了配置结构变化对用户体验的影响
     - [ ] 从用户使用角度描述了每个代理的价值
   - **命令系统检查**：
     - [ ] 对比了当前版本和更新版本的命令文件列表
     - [ ] 分析了新增命令和现有命令的优化
     - [ ] 深入分析了每个现有命令文件的具体变更内容
     - [ ] 分析了命令结构、用户输入格式、工作流程的改进
     - [ ] 识别了现有命令新增的功能特性
     - [ ] 分析了命令结构、提示优化对用户体验的改进
     - [ ] 从用户使用角度描述了每个命令的价值
   - **CLI工具检查**：
     - [ ] 分析了安装体验、项目初始化、工具检查等改进
     - [ ] 从用户使用角度描述了每个改进的价值
     - [ ] 避免了技术实现细节的描述
   - **用户价值检查**：
     - [ ] 每个改进都说明了用户能感受到的好处
     - [ ] 使用了用户容易理解的语言
     - [ ] 避免了技术术语和实现细节
     - [ ] 明确了使用场景和预期效果
   - **详细说明检查**：
     - [ ] 每个功能都按结构化方式展示（标题、子功能）
     - [ ] 每个功能都包含使用场景说明
     - [ ] 每个功能都包含具体改进详细说明
     - [ ] 每个功能都包含用户价值说明
     - [ ] 内容详细但聚焦用户价值，避免纯技术描述
