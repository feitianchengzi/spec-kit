# Templates 模板系统指南

## 概述

Templates 目录是 spec-kit 项目的模板系统核心，包含了用于生成项目文档、计划和任务的标准化模板。这些模板为 spec-driven 开发流程提供了结构化的文档框架，确保项目的一致性和完整性。

## 目录结构

```
templates/
├── agent-file-template.md          # AI 代理文件模板
├── commands/                       # 命令模板目录
│   ├── plan.md                     # 计划命令模板
│   ├── specify.md                  # 规范命令模板
│   └── tasks.md                    # 任务命令模板
├── plan-template.md                # 实现计划模板
├── spec-template.md                # 功能规范模板
└── tasks-template.md               # 任务列表模板
```

## 核心模板详解

### 1. spec-template.md - 功能规范模板

**作用**: 为功能规范文档提供标准化结构，确保所有功能都有完整、一致的规范定义。

#### 文档结构

```markdown
# Feature Specification: [FEATURE NAME]
**Feature Branch**: `[###-feature-name]`
**Created**: [DATE]
**Status**: Draft
**Input**: User description: "$ARGUMENTS"
```

#### 核心部分

1. **执行流程 (Execution Flow)**
   - 定义了规范创建的主要步骤
   - 包含错误处理和验证逻辑
   - 确保规范的完整性和质量

2. **快速指南 (Quick Guidelines)**
   - ✅ 专注于用户需求和原因
   - ❌ 避免实现细节（技术栈、API、代码结构）
   - 👥 为业务利益相关者编写，而非开发者

3. **用户场景和测试 (User Scenarios & Testing)**
   - **主要用户故事**: 描述主要用户旅程
   - **验收场景**: Given-When-Then 格式
   - **边界情况**: 处理边界条件和错误场景

4. **需求 (Requirements)**
   - **功能需求**: 具体的、可测试的能力要求
   - **关键实体**: 涉及数据时的实体定义
   - **模糊需求标记**: 使用 `[NEEDS CLARIFICATION]` 标记

5. **审查和验收检查清单**
   - **内容质量**: 无实现细节、专注用户价值
   - **需求完整性**: 无模糊标记、可测试、可测量

#### 使用场景

- 创建新功能时作为起始模板
- 确保规范文档的标准化
- 指导 AI 代理生成规范内容

### 2. plan-template.md - 实现计划模板

**作用**: 为功能实现提供详细的技术规划和设计指导。

#### 文档结构

```markdown
# Implementation Plan: [FEATURE]
**Branch**: `[###-feature-name]` | **Date**: [DATE] | **Spec**: [link]
**Input**: Feature specification from `/specs/[###-feature-name]/spec.md`
```

#### 核心部分

1. **执行流程 (/plan 命令范围)**
   - 定义了计划创建的主要步骤
   - 包含宪法检查和验证逻辑
   - 分阶段执行：研究 → 设计 → 任务规划

2. **技术上下文 (Technical Context)**
   - 编程语言/版本
   - 主要依赖
   - 存储方案
   - 测试框架
   - 目标平台
   - 项目类型
   - 性能目标
   - 约束条件
   - 规模/范围

3. **宪法检查 (Constitution Check)**
   - **简洁性**: 项目数量、框架使用、数据模型
   - **架构**: 库优先、CLI 接口、文档要求
   - **测试**: TDD 强制、测试顺序、真实依赖
   - **可观测性**: 结构化日志、错误上下文
   - **版本控制**: 版本号、破坏性变更处理

4. **项目结构 (Project Structure)**
   - 文档结构（功能相关）
   - 源代码结构（单项目/Web应用/移动应用）
   - 结构决策逻辑

5. **分阶段执行**
   - **Phase 0**: 研究和概述
   - **Phase 1**: 设计和合约
   - **Phase 2**: 任务规划方法
   - **Phase 3+**: 未来实现

#### 使用场景

- 从功能规范生成实现计划
- 指导技术选型和架构设计
- 确保符合项目宪法要求

### 3. tasks-template.md - 任务列表模板

**作用**: 为功能实现提供具体的、可执行的任务列表。

#### 文档结构

```markdown
# Tasks: [FEATURE NAME]
**Input**: Design documents from `/specs/[###-feature-name]/`
**Prerequisites**: plan.md (required), research.md, data-model.md, contracts/
```

#### 核心部分

1. **执行流程 (Execution Flow)**
   - 定义任务生成的主要步骤
   - 包含任务验证和完整性检查
   - 确保任务的可执行性

2. **任务格式**
   - `[ID] [P?] Description` 格式
   - `[P]` 标记可并行执行的任务
   - 包含确切的文件路径

3. **分阶段任务**
   - **Phase 3.1**: 设置（项目结构、依赖、工具）
   - **Phase 3.2**: 测试优先（TDD 强制）
   - **Phase 3.3**: 核心实现
   - **Phase 3.4**: 集成
   - **Phase 3.5**: 完善

4. **依赖关系**
   - 测试在实现之前
   - 模型在服务之前
   - 服务在端点之前
   - 实现在完善之前

5. **并行执行示例**
   - 展示可并行执行的任务组
   - 提供具体的执行命令

#### 使用场景

- 从设计文档生成具体任务
- 指导开发团队按顺序执行
- 支持并行开发工作

### 4. agent-file-template.md - AI 代理文件模板

**作用**: 为 AI 代理提供项目上下文和开发指导。

#### 文档结构

```markdown
# [PROJECT NAME] Development Guidelines
Auto-generated from all feature plans. Last updated: [DATE]
```

#### 核心部分

1. **活跃技术 (Active Technologies)**
   - 从所有计划文件中提取的技术栈
   - 包含编程语言、框架、工具

2. **项目结构 (Project Structure)**
   - 基于实际计划的项目结构
   - 反映当前的项目组织

3. **命令 (Commands)**
   - 仅包含活跃技术的命令
   - 提供具体的执行指令

4. **代码风格 (Code Style)**
   - 语言特定的编码规范
   - 仅包含正在使用的语言

5. **最近变更 (Recent Changes)**
   - 最后3个功能及其添加内容
   - 保持变更历史的简洁性

6. **手动添加部分**
   - 保留手动添加的内容
   - 支持自定义指导

#### 使用场景

- 为 AI 代理提供项目上下文
- 确保 AI 建议符合项目标准
- 维护开发指导的一致性

## 命令模板详解

### 1. commands/specify.md - 规范命令模板

**作用**: 定义 `/specify` 命令的执行逻辑和脚本调用。

#### 核心功能

1. **脚本调用**
   - Bash: `scripts/bash/create-new-feature.sh --json "{ARGS}"`
   - PowerShell: `scripts/powershell/create-new-feature.ps1 -Json "{ARGS}"`

2. **执行步骤**
   - 运行脚本并解析 JSON 输出
   - 加载规范模板
   - 写入规范文件
   - 报告完成状态

3. **输出信息**
   - 分支名称
   - 规范文件路径
   - 下一阶段准备状态

#### 使用场景

- AI 代理执行规范创建命令
- 确保规范创建流程的一致性
- 提供标准化的命令接口

### 2. commands/plan.md - 计划命令模板

**作用**: 定义 `/plan` 命令的执行逻辑和实现计划生成。

#### 核心功能

1. **脚本调用**
   - Bash: `scripts/bash/setup-plan.sh --json`
   - PowerShell: `scripts/powershell/setup-plan.ps1 -Json`

2. **执行步骤**
   - 运行脚本并解析输出
   - 读取和分析功能规范
   - 读取宪法要求
   - 执行实现计划模板
   - 验证执行完成

3. **生成文档**
   - Phase 0: research.md
   - Phase 1: data-model.md, contracts/, quickstart.md
   - Phase 2: tasks.md

#### 使用场景

- AI 代理执行计划创建命令
- 确保计划生成流程的一致性
- 提供标准化的计划接口

### 3. commands/tasks.md - 任务命令模板

**作用**: 定义 `/tasks` 命令的执行逻辑和任务生成。

#### 核心功能

1. **脚本调用**
   - Bash: `scripts/bash/check-task-prerequisites.sh --json`
   - PowerShell: `scripts/powershell/check-task-prerequisites.ps1 -Json`

2. **执行步骤**
   - 运行脚本并解析输出
   - 加载和分析设计文档
   - 生成任务列表
   - 应用任务规则
   - 创建任务文件

3. **任务生成规则**
   - 从合约生成合约测试任务
   - 从数据模型生成模型任务
   - 从用户故事生成集成测试任务
   - 按依赖关系排序任务

#### 使用场景

- AI 代理执行任务生成命令
- 确保任务生成流程的一致性
- 提供标准化的任务接口

## 模板系统特点

### 1. 结构化设计

- **标准化格式**: 所有模板都遵循一致的结构
- **占位符系统**: 使用 `[PLACEHOLDER]` 标记需要替换的内容
- **版本控制**: 模板包含版本信息和更新日期

### 2. 自动化集成

- **脚本集成**: 模板与脚本系统紧密集成
- **AI 代理支持**: 为 AI 代理提供标准化的执行指导
- **跨平台兼容**: 支持 Bash 和 PowerShell 两种脚本

### 3. 质量保证

- **验证检查**: 模板包含质量验证检查清单
- **错误处理**: 定义明确的错误处理逻辑
- **完整性检查**: 确保生成文档的完整性

### 4. 可扩展性

- **模块化设计**: 模板可以独立使用或组合使用
- **自定义支持**: 支持手动添加和自定义内容
- **版本管理**: 支持模板的版本控制和更新

## 使用工作流

### 1. 功能开发流程

1. **创建规范**:
   ```bash
   # 使用 specify 命令
   /specify "用户认证系统"
   # 生成 spec.md 文件
   ```

2. **生成计划**:
   ```bash
   # 使用 plan 命令
   /plan "Python 3.11, FastAPI, PostgreSQL"
   # 生成 plan.md, research.md, data-model.md 等
   ```

3. **创建任务**:
   ```bash
   # 使用 tasks 命令
   /tasks
   # 生成 tasks.md 文件
   ```

### 2. 模板自定义

1. **修改现有模板**:
   - 编辑模板文件
   - 更新占位符和结构
   - 测试模板生成

2. **创建新模板**:
   - 基于现有模板创建
   - 定义新的结构和占位符
   - 集成到命令系统中

### 3. 质量保证

1. **模板验证**:
   - 检查占位符完整性
   - 验证结构一致性
   - 测试生成流程

2. **文档审查**:
   - 检查生成文档的质量
   - 验证内容完整性
   - 确保符合项目标准

## 最佳实践

### 1. 模板设计

- **保持简洁**: 模板应该清晰、简洁、易于理解
- **避免重复**: 避免在模板中重复相同的内容
- **明确占位符**: 使用清晰的占位符命名
- **版本控制**: 为模板添加版本信息

### 2. 内容生成

- **遵循结构**: 严格按照模板结构生成内容
- **填充占位符**: 确保所有占位符都被正确替换
- **质量检查**: 生成后检查内容质量
- **验证完整性**: 确保生成文档的完整性

### 3. 维护更新

- **定期审查**: 定期审查模板的有效性
- **版本同步**: 保持模板版本与项目版本同步
- **文档更新**: 及时更新相关文档
- **测试验证**: 更新后测试模板生成

## 故障排除

### 常见问题

1. **占位符未替换**:
   - 检查占位符格式是否正确
   - 验证替换逻辑是否完整
   - 确认数据源是否可用

2. **结构不完整**:
   - 检查模板结构是否完整
   - 验证必需部分是否包含
   - 确认生成逻辑是否正确

3. **质量检查失败**:
   - 检查内容是否符合要求
   - 验证格式是否正确
   - 确认完整性是否满足

### 调试技巧

1. **使用调试模式**: 启用详细的调试输出
2. **检查中间结果**: 查看生成过程中的中间文件
3. **验证输入数据**: 确认输入数据的正确性
4. **测试模板**: 使用测试数据验证模板

## 扩展和自定义

### 1. 添加新模板

1. 创建新的模板文件
2. 定义模板结构和占位符
3. 集成到命令系统中
4. 更新相关文档

### 2. 修改现有模板

1. 备份原始模板
2. 进行必要的修改
3. 测试修改后的模板
4. 更新版本信息

### 3. 集成新功能

1. 分析新功能需求
2. 设计相应的模板结构
3. 实现模板生成逻辑
4. 集成到现有工作流

Templates 模板系统是 spec-kit 项目的核心组件，通过标准化的模板确保项目文档的一致性和质量。正确使用这些模板可以显著提高开发效率和文档质量。
